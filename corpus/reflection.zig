================================================================================
reflection
================================================================================

    const expect = @import("std").testing.expect;
const mem = @import("std").mem;
const reflection = @This();

test "reflection: function return type, var args, and param types" {
    comptime {
        const info = @typeInfo(@TypeOf(dummy)).Fn;
        expect(info.return_type.? == i32);
        expect(!info.is_var_args);
        expect(info.args.len == 3);
        expect(info.args[0].arg_type.? == bool);
        expect(info.args[1].arg_type.? == i32);
        expect(info.args[2].arg_type.? == f32);
    }
}

fn dummy(a: bool, b: i32, c: f32) i32 {
    return 1234;
}

test "reflection: @field" {
    var f = Foo{
        .one = 42,
        .two = true,
        .three = void{},
    };

    expect(f.one == f.one);
    expect(@field(f, "o" ++ "ne") == f.one);
    expect(@field(f, "t" ++ "wo") == f.two);
    expect(@field(f, "th" ++ "ree") == f.three);
    expect(@field(Foo, "const" ++ "ant") == Foo.constant);
    expect(@field(Bar, "O" ++ "ne") == Bar.One);
    expect(@field(Bar, "T" ++ "wo") == Bar.Two);
    expect(@field(Bar, "Th" ++ "ree") == Bar.Three);
    expect(@field(Bar, "F" ++ "our") == Bar.Four);
    expect(@field(reflection, "dum" ++ "my")(true, 1, 2) == dummy(true, 1, 2));
    @field(f, "o" ++ "ne") = 4;
    expect(f.one == 4);
}

const Foo = struct {
    const constant = 52;

    one: i32,
    two: bool,
    three: void,
};

const Bar = union(enum) {
    One: void,
    Two: i32,
    Three: bool,
    Four: f64,
};

--------------------------------------------------------------------------------

(source_file
  (VarDecl
    (IDENTIFIER)
    (SuffixExpr
      (BUILTINIDENTIFIER)
      (FnCallArguments
        (SuffixExpr
          (STRINGLITERAL
            (STRINGLITERALSINGLE))))
      (SuffixOp
        (IDENTIFIER))
      (SuffixOp
        (IDENTIFIER))))
  (VarDecl
    (IDENTIFIER)
    (SuffixExpr
      (BUILTINIDENTIFIER)
      (FnCallArguments
        (SuffixExpr
          (STRINGLITERAL
            (STRINGLITERALSINGLE))))
      (SuffixOp
        (IDENTIFIER))))
  (VarDecl
    (IDENTIFIER)
    (SuffixExpr
      (BUILTINIDENTIFIER)
      (FnCallArguments)))
  (TestDecl
    (STRINGLITERALSINGLE)
    (Block
      (BlockExprStatement
        (BlockExpr
          (Block
            (VarDecl
              (IDENTIFIER)
              (SuffixExpr
                (BUILTINIDENTIFIER)
                (FnCallArguments
                  (SuffixExpr
                    (BUILTINIDENTIFIER)
                    (FnCallArguments
                      (SuffixExpr
                        (IDENTIFIER)))))
                (SuffixOp
                  (IDENTIFIER))))
            (AssignExpr
              (SuffixExpr
                (IDENTIFIER)
                (FnCallArguments
                  (BinaryExpr
                    (SuffixExpr
                      (IDENTIFIER)
                      (SuffixOp
                        (IDENTIFIER))
                      (SuffixOp))
                    (CompareOp)
                    (SuffixExpr
                      (BuildinTypeExpr))))))
            (AssignExpr
              (SuffixExpr
                (IDENTIFIER)
                (FnCallArguments
                  (UnaryExpr (PrefixOp)
                  (SuffixExpr
                    (IDENTIFIER)
                    (SuffixOp
                      (IDENTIFIER)))))))
          (AssignExpr
            (SuffixExpr
              (IDENTIFIER)
              (FnCallArguments
                (BinaryExpr
                  (SuffixExpr
                    (IDENTIFIER)
                    (SuffixOp
                      (IDENTIFIER))
                    (SuffixOp
                      (IDENTIFIER)))
                  (CompareOp)
                  (SuffixExpr
                    (INTEGER))))))
          (AssignExpr
            (SuffixExpr
              (IDENTIFIER)
              (FnCallArguments
                (BinaryExpr
                  (SuffixExpr
                    (IDENTIFIER)
                    (SuffixOp
                      (IDENTIFIER))
                    (SuffixOp
                      (SuffixExpr
                        (INTEGER)))
                    (SuffixOp
                      (IDENTIFIER))
                    (SuffixOp))
                  (CompareOp)
                  (SuffixExpr
                    (BuildinTypeExpr))))))
          (AssignExpr
            (SuffixExpr
              (IDENTIFIER)
              (FnCallArguments
                (BinaryExpr
                  (SuffixExpr
                    (IDENTIFIER)
                    (SuffixOp
                      (IDENTIFIER))
                    (SuffixOp
                      (SuffixExpr
                        (INTEGER)))
                    (SuffixOp
                      (IDENTIFIER))
                    (SuffixOp))
                  (CompareOp)
                  (SuffixExpr
                    (BuildinTypeExpr))))))
          (AssignExpr
            (SuffixExpr
              (IDENTIFIER)
              (FnCallArguments
                (BinaryExpr
                  (SuffixExpr
                    (IDENTIFIER)
                    (SuffixOp
                      (IDENTIFIER))
                    (SuffixOp
                      (SuffixExpr
                        (INTEGER)))
                    (SuffixOp
                      (IDENTIFIER))
                    (SuffixOp))
                  (CompareOp)
                  (SuffixExpr
                    (BuildinTypeExpr)))))))))))(FnProto
  (IDENTIFIER)
  (ParamDeclList
    (ParamDecl
      (IDENTIFIER)
      (ParamType
        (SuffixExpr
          (BuildinTypeExpr))))
    (ParamDecl
      (IDENTIFIER)
      (ParamType
        (SuffixExpr
          (BuildinTypeExpr))))
    (ParamDecl
      (IDENTIFIER)
      (ParamType
        (SuffixExpr
          (BuildinTypeExpr)))))
  (SuffixExpr
    (BuildinTypeExpr)))(Block
  (AssignExpr
    (SuffixExpr
      (INTEGER))))(TestDecl
  (STRINGLITERALSINGLE)
  (Block
    (VarDecl
      (IDENTIFIER)
      (SuffixExpr
        (IDENTIFIER))
      (InitList
        (FieldInit
          (IDENTIFIER)
          (SuffixExpr
            (INTEGER)))
        (FieldInit
          (IDENTIFIER)
          (SuffixExpr))
        (FieldInit
          (IDENTIFIER)
          (SuffixExpr
            (BuildinTypeExpr))
          (InitList))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE))))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))))))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (BUILTINIDENTIFIER)
              (FnCallArguments
                (SuffixExpr
                  (IDENTIFIER))
                (BinaryExpr
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))
                  (AdditionOp)
                  (SuffixExpr
                    (STRINGLITERAL
                      (STRINGLITERALSINGLE)))))
              (FnCallArguments
                (SuffixExpr)
                (SuffixExpr
                  (INTEGER))
                (SuffixExpr
                  (INTEGER))))
            (CompareOp)
            (SuffixExpr
              (IDENTIFIER)
              (FnCallArguments
                (SuffixExpr)
                (SuffixExpr
                  (INTEGER))
                (SuffixExpr
                  (INTEGER))))))))
    (AssignExpr
      (SuffixExpr
        (BUILTINIDENTIFIER)
        (FnCallArguments
          (SuffixExpr
            (IDENTIFIER))
          (BinaryExpr
            (SuffixExpr
              (STRINGLITERAL
                (STRINGLITERALSINGLE)))
            (AdditionOp)
            (SuffixExpr
              (STRINGLITERAL
                (STRINGLITERALSINGLE))))))
      (AssignOp)
      (SuffixExpr
        (INTEGER)))
    (AssignExpr
      (SuffixExpr
        (IDENTIFIER)
        (FnCallArguments
          (BinaryExpr
            (SuffixExpr
              (IDENTIFIER)
              (SuffixOp
                (IDENTIFIER)))
            (CompareOp)
            (SuffixExpr
              (INTEGER))))))))(VarDecl
  (IDENTIFIER)
  (SuffixExpr
    (ContainerDecl
      (ContainerDeclType)
      (VarDecl
        (IDENTIFIER)
        (SuffixExpr
          (INTEGER)))
      (ContainerField
        (IDENTIFIER)
        (SuffixExpr
          (BuildinTypeExpr)))
      (ContainerField
        (IDENTIFIER)
        (SuffixExpr
          (BuildinTypeExpr)))
      (ContainerField
        (IDENTIFIER)
        (SuffixExpr
          (BuildinTypeExpr))))))(VarDecl
  (IDENTIFIER)
  (SuffixExpr
    (ContainerDecl
      (ContainerDeclType)
      (ContainerField
        (IDENTIFIER)
        (SuffixExpr
          (BuildinTypeExpr)))
      (ContainerField
        (IDENTIFIER)
        (SuffixExpr
          (BuildinTypeExpr)))
      (ContainerField
        (IDENTIFIER)
        (SuffixExpr
          (BuildinTypeExpr)))
      (ContainerField
        (IDENTIFIER)
        (SuffixExpr
          (BuildinTypeExpr)))))))
