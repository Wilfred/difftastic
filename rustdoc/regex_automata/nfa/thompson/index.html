<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Defines a Thompson NFA and provides the `PikeVM` and `BoundedBacktracker` regex engines."><meta name="keywords" content="rust, rustlang, rust-lang, thompson"><title>regex_automata::nfa::thompson - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../regex_automata/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../regex_automata/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module thompson</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../regex_automata/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">regex_automata</a>::<wbr><a href="../index.html">nfa</a>::<wbr><a class="mod" href="#">thompson</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/regex_automata/nfa/thompson/mod.rs.html#1-81">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Defines a Thompson NFA and provides the <a href="pikevm/struct.PikeVM.html"><code>PikeVM</code></a> and
<a href="backtrack/struct.BoundedBacktracker.html"><code>BoundedBacktracker</code></a> regex engines.</p>
<p>A Thompson NFA (non-deterministic finite automaton) is arguably <em>the</em> central
data type in this library. It is the result of what is commonly referred to as
“regex compilation.” That is, turning a regex pattern from its concrete syntax
string into something that can run a search looks roughly like this:</p>
<ul>
<li>A <code>&amp;str</code> is parsed into a <a href="../../../regex_syntax/ast/enum.Ast.html"><code>regex-syntax::ast::Ast</code></a>.</li>
<li>An <code>Ast</code> is translated into a <a href="../../../regex_syntax/hir/struct.Hir.html"><code>regex-syntax::hir::Hir</code></a>.</li>
<li>An <code>Hir</code> is compiled into a <a href="struct.NFA.html" title="NFA"><code>NFA</code></a>.</li>
<li>The <code>NFA</code> is then used to build one of a few different regex engines:
<ul>
<li>An <code>NFA</code> is used directly in the <code>PikeVM</code> and <code>BoundedBacktracker</code> engines.</li>
<li>An <code>NFA</code> is used by a <a href="../../hybrid/index.html">hybrid NFA/DFA</a> to build out a DFA’s
transition table at search time.</li>
<li>An <code>NFA</code>, assuming it is one-pass, is used to build a full
<a href="../../dfa/onepass/index.html">one-pass DFA</a> ahead of time.</li>
<li>An <code>NFA</code> is used to build a <a href="../../dfa/index.html">full DFA</a> ahead of time.</li>
</ul>
</li>
</ul>
<p>The <a href="../../meta/index.html"><code>meta</code></a> regex engine makes all of these choices for you based
on various criteria. However, if you have a lower level use case, <em>you</em> can
build any of the above regex engines and use them directly. But you must start
here by building an <code>NFA</code>.</p>
<h2 id="details"><a href="#details">Details</a></h2>
<p>It is perhaps worth expanding a bit more on what it means to go through the
<code>&amp;str</code>-&gt;<code>Ast</code>-&gt;<code>Hir</code>-&gt;<code>NFA</code> process.</p>
<ul>
<li>Parsing a string into an <code>Ast</code> gives it a structured representation.
Crucially, the size and amount of work done in this step is proportional to the
size of the original string. No optimization or Unicode handling is done at
this point. This means that parsing into an <code>Ast</code> has very predictable costs.
Moreover, an <code>Ast</code> can be roundtripped back to its original pattern string as
written.</li>
<li>Translating an <code>Ast</code> into an <code>Hir</code> is a process by which the structured
representation is simplified down to its most fundamental components.
Translation deals with flags such as case insensitivity by converting things
like <code>(?i:a)</code> to <code>[Aa]</code>. Translation is also where Unicode tables are consulted
to resolve things like <code>\p{Emoji}</code> and <code>\p{Greek}</code>. It also flattens each
character class, regardless of how deeply nested it is, into a single sequence
of non-overlapping ranges. All the various literal forms are thrown out in
favor of one common representation. Overall, the <code>Hir</code> is small enough to fit
into your head and makes analysis and other tasks much simpler.</li>
<li>Compiling an <code>Hir</code> into an <code>NFA</code> formulates the regex into a finite state
machine whose transitions are defined over bytes. For example, an <code>Hir</code> might
have a Unicode character class corresponding to a sequence of ranges defined
in terms of <code>char</code>. Compilation is then responsible for turning those ranges
into a UTF-8 automaton. That is, an automaton that matches the UTF-8 encoding
of just the codepoints specified by those ranges. Otherwise, the main job of
an <code>NFA</code> is to serve as a byte-code of sorts for a virtual machine. It can be
seen as a sequence of instructions for how to match a regex.</li>
</ul>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="backtrack/index.html" title="regex_automata::nfa::thompson::backtrack mod">backtrack</a></div><div class="item-right docblock-short">An NFA backed bounded backtracker for executing regex searches with capturing
groups.</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="pikevm/index.html" title="regex_automata::nfa::thompson::pikevm mod">pikevm</a></div><div class="item-right docblock-short">An NFA backed Pike VM for executing regex searches with capturing groups.</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BuildError.html" title="regex_automata::nfa::thompson::BuildError struct">BuildError</a></div><div class="item-right docblock-short">An error that can occurred during the construction of a thompson NFA.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Builder.html" title="regex_automata::nfa::thompson::Builder struct">Builder</a></div><div class="item-right docblock-short">An abstraction for building Thompson NFAs by hand.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Compiler.html" title="regex_automata::nfa::thompson::Compiler struct">Compiler</a></div><div class="item-right docblock-short">A builder for compiling an NFA from a regex’s high-level intermediate
representation (HIR).</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Config.html" title="regex_automata::nfa::thompson::Config struct">Config</a></div><div class="item-right docblock-short">The configuration used for a Thompson NFA compiler.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DenseTransitions.html" title="regex_automata::nfa::thompson::DenseTransitions struct">DenseTransitions</a></div><div class="item-right docblock-short">A sequence of transitions used to represent a dense state.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.NFA.html" title="regex_automata::nfa::thompson::NFA struct">NFA</a></div><div class="item-right docblock-short">A byte oriented Thompson non-deterministic finite automaton (NFA).</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.PatternIter.html" title="regex_automata::nfa::thompson::PatternIter struct">PatternIter</a></div><div class="item-right docblock-short">An iterator over all pattern IDs in an NFA.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SparseTransitions.html" title="regex_automata::nfa::thompson::SparseTransitions struct">SparseTransitions</a></div><div class="item-right docblock-short">A sequence of transitions used to represent a sparse state.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Transition.html" title="regex_automata::nfa::thompson::Transition struct">Transition</a></div><div class="item-right docblock-short">A single transition to another state.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.State.html" title="regex_automata::nfa::thompson::State enum">State</a></div><div class="item-right docblock-short">A state in an NFA.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.WhichCaptures.html" title="regex_automata::nfa::thompson::WhichCaptures enum">WhichCaptures</a></div><div class="item-right docblock-short">A configuration indicating which kinds of
<a href="enum.State.html#variant.Capture"><code>State::Capture</code></a> states to include.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="regex_automata" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>